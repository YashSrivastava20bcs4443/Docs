import requests
import webbrowser

def apply_filter(url, filter_value):
    headers = {
        'kbn-xsrf': 'true',
        'Content-Type': 'application/json',
    }

    filter_query = {
        "filters": [
            {
                "meta": {
                    "alias": None,
                    "disabled": False,
                    "key": "Eventstatus",
                    "negate": False,
                    "type": "phrase",
                    "value": filter_value
                },
                "query": {
                    "match": {
                        "Eventstatus": {
                            "query": filter_value,
                            "type": "phrase"
                        }
                    }
                }
            }
        ]
    }

    try:
        response = requests.post(url, headers=headers, json=filter_query)
        response.raise_for_status()
        print("Filter applied successfully.")
        
        # Open Kibana dashboard URL in default web browser
        webbrowser.open(response.json()['url'])
        print("Kibana dashboard will open in your default web browser.")
    except requests.exceptions.RequestException as e:
        print(f"An error occurred: {e}")

# Example usage
dashboard_url = "https://kibana2.fareportal.com/api/dashboards/resolve_and_search"
filter_value = "active"
apply_filter(dashboard_url, filter_value)
