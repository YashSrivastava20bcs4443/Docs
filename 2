import pandas as pd
from fbprophet import Prophet
import matplotlib.pyplot as plt

# Load the dataset
df = pd.read_csv('your_dataset.csv')

# Preprocess the data
df['Interval'] = pd.to_datetime(df['Interval'])
df.rename(columns={'Interval': 'ds', 'Average Max': 'y'}, inplace=True)

# Prepare the data for Prophet
prophet_df = df[['ds', 'y']]

# Initialize and fit the model
model = Prophet()
model.fit(prophet_df)

# Make future dataframe for predictions
future = model.make_future_dataframe(periods=30)  # Predicting for the next 30 days
forecast = model.predict(future)

# Plot the forecast
fig = model.plot(forecast)
plt.xlabel('Date')
plt.ylabel('Average Max')
plt.title('Forecast of Average Max CPU and Memory Usage')
plt.show()

# Evaluate the model (optional)
from sklearn.metrics import mean_squared_error, r2_score

# Only evaluate on the historical part
y_true = prophet_df['y']
y_pred = forecast.loc[forecast['ds'].isin(prophet_df['ds']), 'yhat']

mse = mean_squared_error(y_true, y_pred)
r2 = r2_score(y_true, y_pred)

print(f'Mean Squared Error: {mse}')
print(f'R-squared: {r2}')
