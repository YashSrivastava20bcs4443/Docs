import time
import smtplib
from selenium import webdriver
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

# Configurations
URL = "https://greekforgreek.com"  # Replace with the homepage URL
SMTP_SERVER = "smtp.example.com"
SMTP_PORT = 587
EMAIL_SENDER = "your-email@example.com"
EMAIL_PASSWORD = "your-email-password"
EMAIL_RECEIVER = "teams-channel-email@example.com"

def scrape_homepage(url):
    """Scrape data from the homepage."""
    driver = webdriver.Chrome()  # Ensure ChromeDriver is in PATH
    driver.get(url)
    time.sleep(5)  # Wait for the page to load completely

    # Get page source and parse with BeautifulSoup
    soup = BeautifulSoup(driver.page_source, "html.parser")
    driver.quit()

    # Extract specific data from the homepage (e.g., headlines, links)
    headlines = soup.find_all("h2")  # Replace 'h2' with the appropriate tag or class
    links = soup.find_all("a", href=True)

    data = "Headlines:\n"
    for headline in headlines:
        data += f"- {headline.text.strip()}\n"

    data += "\nLinks:\n"
    for link in links[:10]:  # Limit to the first 10 links
        data += f"- {link['href']}\n"

    return data

def send_email(subject, body, receiver_email):
    """Send the scraped data via email."""
    msg = MIMEMultipart()
    msg['From'] = EMAIL_SENDER
    msg['To'] = receiver_email
    msg['Subject'] = subject
    msg.attach(MIMEText(body, 'plain'))

    with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as server:
        server.starttls()
        server.login(EMAIL_SENDER, EMAIL_PASSWORD)
        server.sendmail(EMAIL_SENDER, receiver_email, msg.as_string())
        print("Email sent successfully.")

def main():
    try:
        # Scrape data
        scraped_data = scrape_homepage(URL)

        # Send scraped data via email
        send_email(
            subject="Greek for Greek Homepage Data",
            body=scraped_data,
            receiver_email=EMAIL_RECEIVER
        )
    except Exception as e:
        print("An error occurred:", e)

if __name__ == "__main__":
    main()
