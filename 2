import requests
import json

# Connection details
unity_ip = "10.245.83.44"
username = "admin"  # Replace with your username
password = "your_password"  # Replace with your password

# Base URL and endpoint
base_url = f"https://{unity_ip}/api/types/pool/instances"
query_params = {
    "compact": "True",
    "fields": "dataReductionRatio,snapSpaceHarvestLowThreshold,sizeUsed,hasCompressionEnabledLuns,poolSpaceHarvestLowThreshold,sizePreallocated,snapSizeSubscribed,sizeFree,health,name,nonBaseSizeSubscribed,compressionPercent,isAllFlash,snapSpaceHarvestHighThreshold,hasCompressionEnabledFs,alertThreshold,creationTime,id,metadataSizeSubscribed,isSnapHarvestEnabled,isEmpty,dataReductionSizeSaved,hasDataReductionEnabledLuns,compressionRatio,raidType,hasDataReductionEnabledFs,type,snapSizeUsed,harvestState,poolSpaceHarvestHighThreshold,rebalanceProgress,sizeTotal,dataReductionPercent,metadataSizeUsed,nonBaseSizeUsed,tiers,isFASTCacheEnabled,sizeSubscribed,compressionSizeSaved,poolFastVP,description,isHarvestEnabled"
}

# Headers for Unity REST API
headers = {
    "X-EMC-REST-CLIENT": "true",
    "Accept": "application/json",
    "Content-Type": "application/json",
}

# Create a session
session = requests.Session()
session.auth = (username, password)
session.headers.update(headers)

# Disable warnings about insecure requests
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

def fetch_pool_data():
    response = session.get(base_url, params=query_params, verify=False)
    if response.status_code == 200:
        return response.json()
    else:
        response.raise_for_status()

# Fetch pool information
pool_info = fetch_pool_data()

# Extract specific capacity details
def extract_capacity_details(data):
    try:
        # Print full response to inspect available fields
        print("Full Response:")
        print(json.dumps(data, indent=4))

        # Access the content part of the response
        entries = data.get('entries', [])
        if entries:
            for entry in entries:
                content = entry.get('content', {})
                print("Entry Content Keys and Values:")
                for key, value in content.items():
                    print(f"{key}: {value}")

                # Extract specific fields
                free_space = content.get('sizeFree', 'N/A')
                total_space = content.get('sizeTotal', 'N/A')
                used_space = content.get('sizeUsed', 'N/A')
                preallocated_space = content.get('sizePreallocated', 'N/A')

                print(f"\nPool Capacity Details:")
                print(f"Free Space: {free_space}")
                print(f"Total Space: {total_space}")
                print(f"Used Space: {used_space}")
                print(f"Preallocated Space: {preallocated_space}")

        else:
            print("No entries found in the response.")

    except KeyError as e:
        print("Error extracting capacity details:", e)

# Extract and print capacity details
extract_capacity_details(pool_info)
