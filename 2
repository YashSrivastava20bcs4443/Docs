import requests
from requests.auth import HTTPBasicAuth

# Define the endpoint
base_url = "https://10.1.3.96/api"
capability_profile_name = "YourCapabilityProfileName"
endpoint = f"/instances/capabilityProfile/name:{capability_profile_name}"

# Set the headers
headers = {
    "X-EMC-REST-CLIENT": "true",
    "Accept": "application/json",
    "Content-type": "application/json",
    "EMC-CSRF-TOKEN": csrf_token,  # Assuming csrf_token is already retrieved
}

# Make the GET request
response = requests.get(
    base_url + endpoint,
    headers=headers,
    auth=HTTPBasicAuth('your_username', 'your_password')
)

# Check for successful response
if response.status_code == 200:
    data = response.json()

    # Print full response for inspection
    print("Full Response:")
    print(data)

    # Extract relevant fields
    try:
        content = data.get("content", {})
        free_space = content.get("free_space", "N/A")
        preallocated_space = content.get("preallocated_space", "N/A")
        used_space = content.get("used_space", "N/A")

        print("System Capacity Details:")
        print(f"Free Space: {free_space}")
        print(f"Preallocated Space: {preallocated_space}")
        print(f"Used Space: {used_space}")

    except KeyError:
        print("Failed to extract system capacity details from response.")

else:
    print(f"Failed to retrieve data. Status Code: {response.status_code}")
