import subprocess
import os

toolsadminpas = os.getenv("toolsadminpas")

# Define PowerShell commands as a multiline string
powershell_script = f"""
param($toolsadminpas)

$dpassword = $toolsadminpas | ConvertTo-SecureString -asPlainText -Force
$username = "tools\\svc_devopsauto"
$credential = New-Object System.Management.Automation.PSCredential ($username, $dpassword)

$ErrorActionPreference = "Stop"
$vmm = ""

Get-SCVMMServer -ComputerName $vmm -Credential $credential

$records = ""

Reset-SCVirtualMachine -VM $records
"""

# Run the PowerShell script using subprocess
process = subprocess.run(
    ["pwsh", "-Command", powershell_script],
    capture_output=True,
    text=True
)

# Check the output and error
if process.returncode == 0:
    print("PowerShell script executed successfully:")
    print(process.stdout)
else:
    print("PowerShell script execution failed:")
    print(process.stderr)
