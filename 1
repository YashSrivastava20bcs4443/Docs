---
- name: Move firewall policy
  hosts: localhost
  gather_facts: no

  vars:
    firewall_ip: "{{ firewall_ip }}"
    username: "{{ username }}"
    password: "{{ password }}"
    policy_id_to_move: "{{ policy_id_to_move }}"
    reference_policy_id: "{{ reference_policy_id }}"
    move_direction: "{{ move_direction }}"

  tasks:
    - name: Move policy on FortiGate firewall
      expect:
        command: ssh {{ username }}@{{ firewall_ip }}
        responses:
          password: "{{ password }}"
          "#": |
            config vdom
            edit root
            config router policy
            move {{ policy_id_to_move }} {{ move_direction }} {{ reference_policy_id }}
            end
            exit
      register: result

    - name: Show result
      debug:
        var: result.stdout_lines
