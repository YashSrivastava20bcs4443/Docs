import pandas as pd

# Load the Excel sheets
sentinel_file = 'sentinel.xlsx'
sccm_file = 'sccm.xlsx'

sentinel = pd.read_excel(sentinel_file)
sccm = pd.read_excel(sccm_file)

# Convert column names to lowercase for consistency
sentinel.columns = sentinel.columns.str.lower()
sccm.columns = sccm.columns.str.lower()

# Define the common columns
common_columns = ['hostname', 'serialnumber', 'model', 'operating system', 'username', 'ip']

# Perform an inner join on hostname and serialnumber
merged_data = pd.merge(
    sentinel, sccm, 
    on=['hostname', 'serialnumber'], 
    suffixes=('_sentinel', '_sccm')
)

# Fill missing data in common columns from sccm to sentinel
for column in common_columns:
    if column in sentinel.columns and column in sccm.columns:
        merged_data[column] = merged_data[f'{column}_sentinel'].combine_first(merged_data[f'{column}_sccm'])

# Drop duplicate columns
columns_to_drop = [f"{col}_sccm" for col in common_columns if f"{col}_sccm" in merged_data.columns]
merged_data = merged_data.drop(columns=columns_to_drop)

# Save the resulting data to a new Excel file
output_file = 'merged_data.xlsx'
merged_data.to_excel(output_file, index=False)

print(f"Data with matching serialnumber and hostname has been merged and saved to {output_file}")
