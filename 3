import psycopg2

def store_data_to_postgresql(data):
    try:
        conn = psycopg2.connect(
            host="172.16.130.247",
            database="your_database_name",
            user="postgres",
            password="Zxcv@1234"
        )
        cursor = conn.cursor()

        # Check if the column exists
        cursor.execute("""
            SELECT column_name 
            FROM information_schema.columns 
            WHERE table_name = 'completed_contacts'
        """)
        existing_columns = [row[0] for row in cursor.fetchall()]

        # Add column if missing
        if "start_date" not in existing_columns:
            cursor.execute("ALTER TABLE completed_contacts ADD COLUMN start_date TIMESTAMP;")
            conn.commit()
            print("Added missing column: start_date")

        # Insert data into the table
        for contact in data:
            cursor.execute("""
            INSERT INTO completed_contacts 
            (contact_id, start_date, end_date, from_addr, to_addr, media_type, is_outbound, master_contact_id)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
            """, (
                contact.get('contactId'),
                contact.get('contactStartDate'),
                contact.get('lastUpdateTime'),
                contact.get('fromAddr'),
                contact.get('toAddr'),
                contact.get('mediaType'),
                contact.get('isOutbound'),
                contact.get('masterContactId')
            ))

        conn.commit()
        print("Data successfully stored in PostgreSQL.")
        cursor.close()
        conn.close()

    except Exception as e:
        print(f"Error storing data to PostgreSQL: {e}")
