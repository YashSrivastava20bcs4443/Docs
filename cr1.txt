import requests

def get_access_token(client_id, client_secret, tenant_id):
    # Function to get access token from Azure AD
    token_url = f"https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token"
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = {
        "client_id": client_id,
        "scope": "https://graph.microsoft.com/.default",
        "client_secret": client_secret,
        "grant_type": "client_credentials"
    }
    response = requests.post(token_url, headers=headers, data=data)
    if response.status_code == 200:
        token = response.json()["access_token"]
        return token
    else:
        print("Failed to get access token:", response.text)
        return None

def send_screenshot_to_teams(api_token, group_id, filename):
    # Function to send the screenshot to Microsoft Teams using API
    url = f"https://graph.microsoft.com/v1.0/groups/{group_id}/drive/root:/General:/children"
    headers = {
        "Authorization": "Bearer " + api_token,
    }
    files = {"file": open(filename, "rb")}
    response = requests.post(url, headers=headers, files=files)
    if response.status_code == 201:
        print("Screenshot sent successfully!")
    else:
        print("Failed to send screenshot:", response.text)

# Main function
def main():
    # Your Azure AD client ID, client secret, and tenant ID
    client_id = "YOUR_CLIENT_ID"
    client_secret = "YOUR_CLIENT_SECRET"
    tenant_id = "YOUR_TENANT_ID"

    # Your Microsoft Teams group ID
    group_id = "e4d3e549-2f9e-4750-b237-dcee218fe130"

    # Path to the screenshot file
    filename = "PATH_TO_YOUR_SCREENSHOT"

    # Get access token
    access_token = get_access_token(client_id, client_secret, tenant_id)
    if access_token:
        print("Access token:", access_token)

        # Send screenshot to Teams
        send_screenshot_to_teams(access_token, group_id, filename)

if __name__ == "__main__":
    main()
