---
- name: Configure IPsec VPN Phase1 Interface on FortiGate firewall
  hosts: fortigate
  gather_facts: no
  vars:
    fortigate_user: "your_username"
    fortigate_ip: "your_fortigate_ip"
    fortigate_password: "your_password"
    vpn_phase1_interface:
      name: "VPN1"
      ike_version: 2
      network_overlay: "enable"
      network_id: 1
      mode_cfg: "enable"
      ipv4_start_ip: "10.251.1.1"
      ipv4_end_ip: "10.251.1.251"
      ipv4_netmask: "255.255.255.0"

  tasks:
    - name: SSH to FortiGate and configure IPsec VPN Phase1 Interface
      expect:
        command: ssh "{{ fortigate_user }}@{{ fortigate_ip }}"
        responses:
          (?i)password: "{{ fortigate_password }}"
          ".*#": |
            config vpn ipsec phase1-interface
            edit "{{ vpn_phase1_interface.name }}"
            set ike-version "{{ vpn_phase1_interface.ike_version }}"
            set network-overlay "{{ vpn_phase1_interface.network_overlay }}"
            set network-id "{{ vpn_phase1_interface.network_id }}"
            set mode-cfg "{{ vpn_phase1_interface.mode_cfg }}"
            set ipv4-start-ip "{{ vpn_phase1_interface.ipv4_start_ip }}"
            set ipv4-end-ip "{{ vpn_phase1_interface.ipv4_end_ip }}"
            set ipv4-netmask "{{ vpn_phase1_interface.ipv4_netmask }}"
            next
            end
            exit
